<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Display Webcam Stream</title>
</head>
 
<body>
<p id="status">here must be FPS value</p>
<video autoplay="true" id="video"></video>
<script>
//let BIG_SIZE = 1920;
let BIG_SIZE = 640;
let N_FRAMES_FPS_COUNT = 5;
let statusElement = document.getElementById('status');
let video = document.getElementById("video");
let timeForFPSCountOld = performance.now();
let CountFPSIndex = 0;
let FPS = 0;
let frameIndex = 0;
const doSomethingWithTheFrame = (now, metadata) => {
  // Do something with the frame.
  //console.log(now, metadata);
  
  let isCountFPS = frameIndex % N_FRAMES_FPS_COUNT == 0;
          
  if (isCountFPS) {
      timeForFPSCount = performance.now();
  }
  
  if (isCountFPS) {
      let timeDelta = timeForFPSCount - timeForFPSCountOld;
      let timeDeltaSec = timeDelta / 1000;
      FPS = N_FRAMES_FPS_COUNT / timeDeltaSec;
      //console.log(FPS);
      statusElement.innerHTML = FPS.toString(10);
      timeForFPSCountOld = timeForFPSCount;
      CountFPSIndex++;
  }
  
  frameIndex++;
  
  
  // Re-register the callback to be notified about the next frame
  video.requestVideoFrameCallback(doSomethingWithTheFrame);
};
// Initially register the callback to be notified about the first frame
resolution = {width: {ideal: BIG_SIZE}, height: {ideal: BIG_SIZE}, frameRate: { ideal: 20, max: 25 } };
camera_settings = {video: resolution, audio: false};
navigator.mediaDevices.getUserMedia(camera_settings)
    .then(function(stream) {
    video.srcObject = stream;
    video.play();
    video.requestVideoFrameCallback(doSomethingWithTheFrame);
    });
</script>
</body>
</html>
